{% extends 'base.html' %}
{% block css%}
{% load static %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="{% static 'css/style_detalles.css'%}">
{%endblock%}
{% block contenido %}

<div class="base">
		<div class="mensaje">
			{%for mensaje in messages%}
			<div class="alert alert-success alert-dismissible fade show" role="alert">
				<strong>Bien hecho!</strong> {{ mensaje }}
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			</div>
			{%endfor%}
		</div>

	<div class="contenedor">
		<div class="detalles">
			<h1 class="titulos">{{emprendimientos.titulo}}</h1>
			<h4 class="resumen">{{emprendimientos.resumen}}</h4>
			<div class="cont">
				<div class="cont-img">
					<img class="img-empr" src="{{emprendimientos.imagen.url}}" alt="foto de emprendimiento">
				</div>			
				<p class="contenido">{{emprendimientos.contenido}}</p>
				<div class="botones">
					{%if emprendimientos.autor == user%}
						<a href="{% url 'empr:editar_emprendimientos' emprendimientos.pk%}" class="btn btn-outline-primary text-center">editar</a>
						<!-- Button trigger modal -->
							<button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
								Eliminar
							  </button>
						
						{%endif%}
						<!-- <a href="{%url 'empr:eliminar_emprendimiento' emprendimientos.pk%}" class="btn btn-info text-center">eliminar</a> -->
						<!-- Modal -->
						
				</div>
			</div>
			<div class="info">
				<p class="autores">AUTOR: {{emprendimientos.autor}}</p>
				<p class="categorias">CATEGORIA: {{emprendimientos.categoria}}</p>
				<p class="fecha">FECHA: {{emprendimientos.creado}}</p>
			</div>
			<!-- Acá van a ir los comentarios -->
			<div class="comentarios">

			</div>
		</div>
	</div>
</div> 
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
	<div class="modal-dialog">
		  <div class="modal-content">
			<div class="modal-body">
				  <p>Estas seguro que desa eliminar: <strong>"{{emprendimientos.titulo}}"?</strong></p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				<button class="btn btn-danger" id="eliminar-btn">Eliminar</button>
			</div>
		  </div>
	</div> 
  </div>
{% endblock contenido %}
{%block script%}
<script>
    $(document).ready(function() {
        $("#eliminar-btn").on("click", function() {
            // Realizamos una solicitud POST al servidor para eliminar el emprendimiento
            $.ajax({
                type: "POST",
                url: "{% url 'empr:eliminar_emprendimiento' emprendimientos.pk %}",
                data: {
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                },
                success: function(data) {
                    // Redireccionamos a la página de listar con el ID del emprendimiento eliminado
                    window.location.href = "{% url 'empr:listar_emprendimientos' %}?emprendimiento_id={{ emprendimientos.pk }}";
                },
                error: function() {
                    alert("Error al eliminar el emprendimiento.");
                }
            })
        });
    });
</script>


  {%endblock script%}